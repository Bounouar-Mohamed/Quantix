generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Channel {
  chat
  realtime
}

model UserUsage {
  id           String   @id @default(cuid())
  userId       String
  tenantId     String?
  firstSeen    DateTime @default(now())
  lastSeen     DateTime @updatedAt
  requests     Int      @default(0)
  tokensIn     Int      @default(0)
  tokensOut    Int      @default(0)
  totalTokens  Int      @default(0)
  totalCost    Float    @default(0)
  channel      Channel
}

model SessionUsage {
  id            String   @id @default(cuid())
  sessionId     String?
  conversationId String?
  userId        String
  model         String
  channel       Channel
  startAt       DateTime @default(now())
  endAt         DateTime?
  tokensIn      Int      @default(0)
  tokensOut     Int      @default(0)
  totalCost     Float    @default(0)
}

model EventUsage {
  id        String   @id @default(cuid())
  ts        DateTime @default(now())
  userId    String?
  sessionId String?
  type      String
  meta      Json?
}

model ConversationThread {
  id                String   @id @default(cuid())
  tenantId          String?
  conversationId    String
  assistantThreadId String
  assistantId       String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@unique([tenantId, conversationId])
  @@index([conversationId])
  @@index([tenantId])
}


